import { Canvas, Controls, Meta } from '@storybook/addon-docs/blocks';

import * as PIDComponentStories from './pid-component.stories';

<Meta of={PIDComponentStories} />

# PID Component

The `pid-component` dynamically renders a component based on the value of the `value` property.
It automatically detects the format of the input `value` and renders the appropriate sub-component.
Depending on the value, it decides which component to render, what priority to give it, and what props to pass to it.

It also renders itself recursively for all its children when unfolded.
You can set the maximum depth of recursion with the `level-of-subcomponents` property.
By default, it is set to 1, which means that it will only render the first level of children, but not their children.
You can prohibit unfolding of the component by setting the `current-level-of-subcomponents` to the same value as the `level-of-subcomponents` property.

You can find the source code of the component [on GitHub](https://github.com/kit-data-manager/pid-component).
To use the component, import the [npm-package](https://www.npmjs.com/package/@kit-data-manager/pid-component)
via [unpkg](https://unpkg.com/).
Note that two scripts are provided: one for modern browsers (type="module") and a fallback for older browsers (
nomodule).
Include **both** scripts to ensure support for modern browsers (ESM) and legacy browsers:

```html
<head>
  <script type="module"
          src="https://unpkg.com/@kit-data-manager/pid-component/dist/pid-component/pid-component.esm.js"></script>
  <script nomodule src="https://unpkg.com/@kit-data-manager/pid-component/dist/pid-component/pid-component.js"></script>
</head>
```


**Please notice that you must use the hyphenated version of an attribute when using the component directly in HTML (e.g. `currentLevelOfSubcomponents` -> `current-level-of-subcomponents`).
When using inside Stencil or with JSX/TSX syntax, you must use the camelCase version.**

## Default

<Canvas of={PIDComponentStories.Default} />

## Controls

<Controls />

---

# Supported Types

The following chapters describe each supported type, the task it solves, available settings, and examples.

## 1. Persistent Identifiers (Handles)

**Task:**
Resolves Handle-based PIDs (e.g., `21.T11981/...`) using the `handle.net` infrastructure. It retrieves the PID record and displays its data entries (like URL, HS_ADMIN, etc.) in a structured table. It supports recursive resolution if a value inside the record is another recognized identifier.

**Settings (HandleType):**
- `ttl` (number): Time-to-live in milliseconds for caching the resolved record.

### Examples

**Standard PID:**
Resolves the handle and displays its values.
<Canvas of={PIDComponentStories.Handle} />

**Without Subcomponents:**
Displays only the top-level PID parts without unfolding the resolved record.
<Canvas of={PIDComponentStories.HandleWithoutSubcomponent} />

**Inline in Text:**
The component can be used inline within text.
<Canvas of={PIDComponentStories.HandleInText} />

---

## 2. Digital Object Identifiers (DOIs)

**Task:**
Resolves DOIs (e.g., `10.1000/xyz`) to fetch metadata from providers like DataCite or CrossRef. It renders a formatted citation preview and allows expanding to view detailed metadata (authors, publication dates, licenses, etc.).

**Settings (DOIType):**
- `citationStyle` (string): The citation style for the preview.
- Options: `APA`, `Chicago`, `IEEE`, `Harvard`, `Anglia Ruskin`.
- Default: `APA`.
- `ttl` (number): Time-to-live for cached metadata.

### Examples

**DOI with DataCite Metadata:**
<Canvas of={PIDComponentStories.DOI_DataCite_JournalPaper} />

**DOI with CrossRef Metadata:**
<Canvas of={PIDComponentStories.DOI_CrossRef_JournalPaper} />

**Configurable Citation Style:**
This example sets the citation style to `APA`.
<Canvas of={PIDComponentStories.DOI_CitationStyles} />

---

## 3. ORCiD (Open Researcher and Contributor ID)

**Task:**
Identifies researchers and contributors. It validates the ORCiD format and fetches the public profile from the ORCiD API. It displays the person's name, biography, affiliations, and other public information.

**Settings (ORCIDType):**
- `showAffiliation` (boolean): Whether to display the person's current affiliation in the summary.
- Default: `true`.
- `affiliationAt` (string/date): A date string or timestamp. If set, it displays the affiliation valid at that specific date.
- `ttl` (number): Time-to-live for cached profile data.

### Examples

**Standard ORCiD:**
<Canvas of={PIDComponentStories.ORCID} />

**ORCiD with Settings:**
Configured to show specific affiliation details.
<Canvas of={PIDComponentStories.ORCIDInRecordWithSettings} />

**Inline in Text:**
<Canvas of={PIDComponentStories.ORCIDInText} />

---

## 4. Research Organization Registry (ROR)

**Task:**
Resolves ROR IDs to identify research organizations. It fetches organization details such as name, acronyms, location, and relationships (parent/child organizations) from the ROR API.

**Settings (RORType):**
- `ttl` (number): Time-to-live for cached organization data.

### Example

<Canvas of={PIDComponentStories.ROR} />

---

## 5. SPDX Licenses

**Task:**
Recognizes SPDX license identifiers (e.g., `Apache-2.0`) or URLs. It validates the license against the SPDX database/API and provides links to the full license text and details.

**Settings (SPDXType):**
- `ttl` (number): Time-to-live for cached license data.

### Examples

**SPDX Short Identifier:**
<Canvas of={PIDComponentStories.SPDXShort} />

**SPDX License URL:**
<Canvas of={PIDComponentStories.SPDXLong} />

---

## 6. JSON Data

**Task:**
Parses and renders JSON strings or objects. It provides a collapsible tree view with syntax highlighting, making complex data structures readable.

**Settings (JSONType):**
- `darkMode` (string): Sets the theme for the JSON viewer.
- Options: `light`, `dark`, `system`.

### Example

<Canvas of={PIDComponentStories.JSON_Object} />

---

## 7. Locales & Flags

**Task:**
Recognizes locale codes (e.g., `de-DE`, `en-US`). It renders the language name and, if a region is specified, the corresponding country flag.

**Settings (LocaleType):**
- None specific.

### Example

<Canvas of={PIDComponentStories.Locale} />

---

## 8. Dates

**Task:**
Detects ISO 8601 date strings. It renders them in a user-friendly, locale-aware format.

**Settings (DateType):**
- Uses browser locale defaults.

### Example

<Canvas of={PIDComponentStories.Date} />

---

## 9. URLs & E-Mails

**Task:**
- **URL**: Renders clickable external links.
- **E-Mail**: Renders clickable `mailto` links. Supports single addresses or comma-separated lists.

**Settings:**
- None specific.

### Examples

**URL:**
<Canvas of={PIDComponentStories.URL} />

**Single E-Mail:**
<Canvas of={PIDComponentStories.Email} />

**Multiple E-Mails:**
<Canvas of={PIDComponentStories.CommaSeperatedMails} />

---

## 10. Fallback

**Task:**
If no other specific type matches the input value, the component renders the value as a simple text string.

### Example

<Canvas of={PIDComponentStories.Fallback} />

---

# Advanced Configuration

## Using Settings

You can pass a JSON array to the `settings` property to configure specific types.

```html
<pid-component
  value="..."
  settings='[
    {"type": "ORCIDType", "values": [{"name": "showAffiliation", "value": false}]},
    {"type": "DOIType", "values": [{"name": "citationStyle", "value": "IEEE"}]}
  ]'
></pid-component>
```

## Recursive Rendering

The component supports recursive rendering for complex data structures (like a PID record containing ORCiDs).

- `level-of-subcomponents`: Controls how deep the recursion goes (default: 1).
- `current-level-of-subcomponents`: Used internally to track depth. Set it equal to `level-of-subcomponents` to prevent initial unfolding.
- `hide-subcomponents`: Boolean attribute to completely disable sub-component rendering.

<Canvas of={PIDComponentStories.ORCIDInRecord} />
